# FitConnect Backend κ°λ° λ΅κ·Έ

## ν”„λ΅μ νΈ κ°μ”
**λ©ν‘**: AI μ±„μ© λ§¤μΉ­ μ„λΉ„μ¤ FitConnectμ λ°±μ—”λ“ μ‹μ¤ν… κµ¬ν„
**λ‹΄λ‹Ή**: AIμ™€ μ•κ³ λ¦¬μ¦ κµ¬ν„
**μ΄λ² μ£Ό λ©ν‘**: μμ„± AI κµ¬ν„κ³Ό LLM μ—°κ²° κµ¬ν„

## κµ¬ν„ν• μ‹μ¤ν… μ•„ν‚¤ν…μ²

### π“ ν”„λ΅μ νΈ κµ¬μ΅°
```
fitconnect-backend/
β”β”€β”€ ai/                      # AI λ¨λ“λ“¤ (λ°±μ—”λ“μ™€ λ¶„λ¦¬)
β”‚   β”β”€β”€ stt/                # Speech-to-Text λ¨λ“
β”‚   β”‚   β”β”€β”€ service.py      # Whisper κΈ°λ° STT μ„λΉ„μ¤
β”‚   β”‚   β”β”€β”€ service_safe.py # μμ΅΄μ„± μ•μ „ μ²λ¦¬ λ²„μ „
β”‚   β”‚   β”β”€β”€ models.py       # Pydantic λ¨λΈλ“¤
β”‚   β”‚   β””β”€β”€ routes.py       # FastAPI λΌμ°ν„°
β”‚   β”β”€β”€ llm/                # Large Language Model λ¨λ“
β”‚   β”‚   β”β”€β”€ service.py      # OpenAI & Anthropic ν†µν•©
β”‚   β”‚   β”β”€β”€ models.py       # LLM κ΄€λ ¨ λ¨λΈλ“¤
β”‚   β”‚   β””β”€β”€ routes.py       # LLM API μ—”λ“ν¬μΈνΈ
β”‚   β”β”€β”€ interview/          # AI μΈν„°λ·° μ‹μ¤ν…
β”‚   β”‚   β”β”€β”€ service.py      # STT+LLM ν†µν•© μΈν„°λ·°
β”‚   β”‚   β”β”€β”€ models.py       # μΈν„°λ·° μ„Έμ… λ¨λΈλ“¤
β”‚   β”‚   β””β”€β”€ routes.py       # μΈν„°λ·° API
β”‚   β””β”€β”€ matching/           # λ§¤μΉ­ μ•κ³ λ¦¬μ¦ (λ―Έκµ¬ν„)
β”β”€β”€ api/                    # REST API λΌμ°ν„°
β”β”€β”€ config/                 # μ„¤μ • κ΄€λ¦¬
β”β”€β”€ core/                   # κ³µν†µ μ ν‹Έλ¦¬ν‹°
β”β”€β”€ main.py                 # FastAPI μ•± μ—”νΈλ¦¬ν¬μΈνΈ
β”β”€β”€ requirements.txt        # Python μμ΅΄μ„±
β”β”€β”€ .env.example           # ν™κ²½λ³€μ μμ 
β””β”€β”€ test_basic_server.py   # κΈ°λ³Έ μ„λ²„ ν…μ¤νΈ
```

## κµ¬ν„λ κΈ°λ¥λ“¤

### π¤ STT (Speech-to-Text) κΈ°λ¥
- **κΈ°μ  μ¤νƒ**: OpenAI Whisper
- **μ§€μ› ν¬λ§·**: WAV, MP3, M4A, OGG, WEBM
- **μ–Έμ–΄ μ§€μ›**: ν•κµ­μ–΄/μμ–΄
- **νΉμ§•**:
  - μ¤λ””μ¤ νμΌ μλ™ λ³€ν™ (16kHz, λ¨λ…Έ)
  - μ•μ „ν• μμ΅΄μ„± μ²λ¦¬ (whisper λ―Έμ„¤μΉμ‹ graceful degradation)
  - νμΌ ν¬κΈ° μ ν• λ° κ²€μ¦

### π§  LLM μ—°κ²° λ° ν†µν•©
- **μ§€μ› ν”„λ΅λ°”μ΄λ”**: OpenAI GPT, Anthropic Claude
- **μ£Όμ” κΈ°λ¥**:
  - μ§€μ›μ ν”„λ΅ν•„ λ¶„μ„ (κΈ°μ μ¤ν‚¬, μ†ν”„νΈμ¤ν‚¬, κ²½λ ¥λ λ²¨ μ¶”μ¶)
  - μ±„μ© κ³µκ³  λ¶„μ„ (μ”κµ¬μ‚¬ν•­, μ°λ€μ‚¬ν•­, νμ‚¬λ¬Έν™” μ¶”μ¶)
  - λ©΄μ ‘ μ§λ¬Έ μλ™ μƒμ„±
  - ν…μ¤νΈ completion API

### π’¬ AI μΈν„°λ·° μ‹μ¤ν…
- **ν•µμ‹¬ κΈ°λ¥**: STT + LLM ν†µν•© μΈν„°λ·°
- **μΈν„°λ·° νƒ€μ…**:
  - `candidate_competency`: μ§€μ›μ μ—­λ‰ λ¶„μ„μ©
  - `job_requirement`: κΈ°μ—… μ±„μ© κ³µκ³  λ¶„μ„μ©
- **μΈν„°λ·° λ‹¨κ³„**: μ†κ° β†’ λ©”μΈ μ§λ¬Έ β†’ ν›„μ† μ§λ¬Έ β†’ λ§λ¬΄λ¦¬
- **νΉμ§•**:
  - μ‹¤μ‹κ°„ μμ„± μ‘λ‹µ μ²λ¦¬
  - AI κΈ°λ° ν›„μ† μ§λ¬Έ μλ™ μƒμ„±
  - μ„Έμ… κ΄€λ¦¬ λ° λ¶„μ„ λ¦¬ν¬νΈ

## κ°λ° κ³Όμ • λ° ν•΄κ²°ν• λ¬Έμ λ“¤

### 1. ν™κ²½ μ„¤μ • λ° μμ΅΄μ„± κ΄€λ¦¬
- **λ¬Έμ **: Python 3.13κ³Ό κΈ°μ΅΄ λΌμ΄λΈλ¬λ¦¬ νΈν™μ„± λ¬Έμ 
- **ν•΄κ²°**: μµμ‹  λ²„μ „μΌλ΅ requirements.txt μ—…λ°μ΄νΈ
- **κ²°κ³Ό**: β… κ°€μƒν™κ²½ μ„¤μ • λ° κΈ°λ³Έ μμ΅΄μ„± μ„¤μΉ μ™„λ£

### 2. FastAPI μ„λ²„ κµ¬λ™
- **λ¬Έμ **: AI λ¨λ“ import μ—λ¬λ΅ μ„λ²„ μ‹μ‘ μ‹¤ν¨
- **ν•΄κ²°**:
  - κΈ°λ³Έ μ„λ²„(`test_basic_server.py`) λ¨Όμ € ν…μ¤νΈ
  - Safe import ν¨ν„΄μΌλ΅ optional dependencies μ²λ¦¬
- **κ²°κ³Ό**: β… μ„λ²„ μ •μƒ μ‹¤ν–‰ (http://localhost:8000)

### 3. λ¨λ“λ³„ λ™μ‘ ν™•μΈ
- **ν…μ¤νΈ κ²°κ³Ό**:
  ```bash
  # κΈ°λ³Έ μ—”λ“ν¬μΈνΈ
  GET / β… {"message": "FitConnect Backend is running"}
  GET /health β… {"status": "healthy"}

  # AI λ¨λ“ μƒνƒ
  GET /api/ai/ β… AI λ¨λ“ μ •λ³΄ λ°ν™
  GET /api/ai/stt/health β… STT μ„λΉ„μ¤ μƒνƒ (μμ΅΄μ„± λ―Έμ„¤μΉ ν™•μΈλ¨)
  GET /api/ai/llm/health β… LLM μ„λΉ„μ¤ μƒνƒ (API ν‚¤ λ―Έμ„¤μ • ν™•μΈλ¨)
  GET /api/ai/interview/health β… μΈν„°λ·° μ‹μ¤ν… μƒνƒ
  ```

## API μ—”λ“ν¬μΈνΈ κµ¬μ΅°

### STT λ¨λ“ (`/api/ai/stt/`)
- `POST /transcribe` - μ¤λ””μ¤ νμΌ μ „μ‚¬
- `GET /health` - μ„λΉ„μ¤ μƒνƒ ν™•μΈ
- `POST /load-model` - λ¨λΈ λ΅λ“
- `GET /limits` - μ—…λ΅λ“ μ ν• μ •λ³΄

### LLM λ¨λ“ (`/api/ai/llm/`)
- `POST /completion` - ν…μ¤νΈ μƒμ„±
- `POST /analyze/profile` - μ§€μ›μ ν”„λ΅ν•„ λ¶„μ„
- `POST /analyze/job` - μ±„μ© κ³µκ³  λ¶„μ„
- `POST /interview/questions` - λ©΄μ ‘ μ§λ¬Έ μƒμ„±
- `GET /health` - μ„λΉ„μ¤ μƒνƒ ν™•μΈ

### μΈν„°λ·° μ‹μ¤ν… (`/api/ai/interview/`)
- `POST /start` - μΈν„°λ·° μ„Έμ… μ‹μ‘
- `GET /{session_id}/question` - λ‹¤μ μ§λ¬Έ κ°€μ Έμ¤κΈ°
- `POST /{session_id}/response` - μμ„± μ‘λ‹µ μ²λ¦¬
- `POST /{session_id}/follow-up` - ν›„μ† μ§λ¬Έ μƒμ„±
- `GET /{session_id}/summary` - μ„Έμ… μ”μ•½
- `POST /{session_id}/end` - μΈν„°λ·° μΆ…λ£

## ν„μ¬ μƒνƒ λ° λ‹¤μ λ‹¨κ³„

### β… μ™„λ£λ μ‘μ—…
1. ν”„λ΅μ νΈ κµ¬μ΅° μ„¤κ³„ λ° μƒμ„±
2. STT, LLM, μΈν„°λ·° μ‹μ¤ν… κΈ°λ³Έ κµ¬ν„
3. FastAPI μ„λ²„ κµ¬λ™ λ° κΈ°λ³Έ API λ™μ‘ ν™•μΈ
4. μμ΅΄μ„± μ•μ „ μ²λ¦¬ (optional imports)

### π”„ ν„μ¬ μ ν•μ‚¬ν•­
- STT: whisper λΌμ΄λΈλ¬λ¦¬ λ―Έμ„¤μΉλ΅ μ‹¤μ  μμ„± μΈμ‹ λ¶κ°€
- LLM: API ν‚¤ λ―Έμ„¤μ •μΌλ΅ μ‹¤μ  AI κΈ°λ¥ λΉ„ν™μ„±ν™”
- λ§¤μΉ­ μ•κ³ λ¦¬μ¦: λ―Έκµ¬ν„ μƒνƒ

### π“‹ λ‹¤μ λ‹¨κ³„
1. **μμ΅΄μ„± μ„¤μΉ**: `pip install openai-whisper torch`
2. **API ν‚¤ μ„¤μ •**: `.env` νμΌμ— OpenAI/Anthropic API ν‚¤ μ¶”κ°€
3. **μ‹¤μ  κΈ°λ¥ ν…μ¤νΈ**: μμ„± νμΌ μ—…λ΅λ“ λ° LLM μ‘λ‹µ ν™•μΈ
4. **λ§¤μΉ­ μ•κ³ λ¦¬μ¦ κµ¬ν„**: λ²΅ν„° μ„λ² λ”© λ° μ μ‚¬λ„ κ³„μ‚°
5. **λ°μ΄ν„°λ² μ΄μ¤ μ—°κ²°**: MySQL μ—°λ™ λ° λ°μ΄ν„° μ €μ¥

## κΈ°μ μ  νΉμ§•

### μ•μ „ν• μμ΅΄μ„± κ΄€λ¦¬
```python
# STT μ„λΉ„μ¤μ—μ„ optional import μ²λ¦¬
try:
    import whisper
    WHISPER_AVAILABLE = True
except ImportError:
    WHISPER_AVAILABLE = False
    # graceful degradation
```

### λ¨λ“ν™”λ μ•„ν‚¤ν…μ²
- κ° AI λ¨λ“μ΄ λ…λ¦½μ μΌλ΅ λ™μ‘
- FastAPIμ router μ‹μ¤ν… ν™μ©
- μ„¤μ • κ΄€λ¦¬ μ¤‘μ•™ν™”

### ν™•μ¥ κ°€λ¥ν• κµ¬μ΅°
- μƒλ΅μ΄ LLM ν”„λ΅λ°”μ΄λ” μ‰½κ² μ¶”κ°€ κ°€λ¥
- μΈν„°λ·° νƒ€μ…λ³„ ν…ν”λ¦Ώ μ‹μ¤ν…
- ν”λ¬κ·ΈμΈ λ°©μ‹μ AI λ¨λ“ κµ¬μ„±

## μμ΅΄μ„± λ¬Έμ  ν•΄κ²° λ° μ‹μ¤ν… ν†µν•© μ™„λ£

### π› Python 3.13 νΈν™μ„± λ¬Έμ  ν•΄κ²°

**λ¬Έμ  μƒν™©**:
- Python 3.13μ—μ„ `audioop` λ¨λ“μ΄ μ κ±°λ¨
- `pydub` λΌμ΄λΈλ¬λ¦¬κ°€ `audioop`μ— μμ΅΄ν•μ—¬ STT κΈ°λ¥ μ‘λ™ λ¶κ°€
- μ„λ²„ μ‹μ‘ μ‹ `ModuleNotFoundError: No module named 'audioop'` μ—λ¬ λ°μƒ

**ν•΄κ²° κ³Όμ •**:
1. **λ¬Έμ  λ¶„μ„**: `audioop`λ” pydubμ μ¤λ””μ¤ λ³€ν™μ— ν•„μ”, Whisper μμ²΄λ” λ¶ν•„μ”
2. **μµμ ν™”λ ν•΄κ²°μ±…**: pydub μ κ±° ν›„ Whisper λ„¤μ΄ν‹°λΈ ν¬λ§· μ§€μ› ν™μ©
3. **μ½”λ“ λ¦¬ν©ν† λ§**: `service_minimal.py` κµ¬ν„μΌλ΅ pydub μμ΅΄μ„± μ™„μ „ μ κ±°

**μµμΆ… ν•΄κ²°μ±…**:
```python
# Before: pydub μ‚¬μ© (audioop μμ΅΄)
from pydub import AudioSegment
audio = AudioSegment.from_file(audio_file_path)

# After: Whisper λ„¤μ΄ν‹°λΈ μ§€μ›
result = self.model.transcribe(audio_file_path)  # μ§μ ‘ μ²λ¦¬
```

### π§Ή μ½”λ“λ² μ΄μ¤ μ •λ¦¬ λ° ν†µμΌ

**μ •λ¦¬λ νμΌλ“¤**:
- β `service_old.py` (μ›λ³Έ pydub λ²„μ „)
- β `service_safe.py` (μ•μ „ import λ²„μ „)
- β `service_minimal.py` (μ„μ‹ νμΌ)
- β… `service.py` (μµμΆ… ν†µν•© λ²„μ „)

**μμ΅΄μ„± μµμ ν™”**:
```diff
# requirements.txt λ³€κ²½μ‚¬ν•­
- speechrecognition==3.10.0
- pydub==0.25.1
+ # STT dependencies (pydub removed - Whisper handles formats natively)
```

### π§ μ „μ²΄ μ‹μ¤ν… ν…μ¤νΈ κ²°κ³Ό

#### β… **μ™„λ£λ κΈ°λ¥ ν…μ¤νΈ**:

**1. LLM κΈ°λ¥ (μ™„λ²½ μ‘λ™)**:
```json
// ν…μ¤νΈ μƒμ„± ν…μ¤νΈ
{
  "content": "μ•λ…•ν•μ„Έμ”! μ–΄λ–»κ² λ„μ™€λ“λ¦΄κΉμ”?",
  "provider": "openai",
  "usage": {"total_tokens": 52}
}

// ν”„λ΅ν•„ λ¶„μ„ ν…μ¤νΈ
{
  "κΈ°μ  μ¤ν‚¬": ["Python", "FastAPI", "Django", "AWS ν΄λΌμ°λ“"],
  "κ²½λ ¥ λ λ²¨": "μ¤‘κΈ‰ (5λ…„ κ²½λ ¥)",
  "μ„±μ¥ μ μ¬λ ¥": "λ†’μ"
}
```

**2. STT κΈ°λ¥ (μ™„λ²½ μ‘λ™)**:
- Whisper base λ¨λΈ λ΅λ“ μ„±κ³µ
- μ§€μ› ν¬λ§·: WAV, MP3, M4A, FLAC, OGG, WEBM
- Python 3.13 μ™„μ „ νΈν™

**3. AI μΈν„°λ·° μ‹μ¤ν… (μ™„λ²½ μ‘λ™)**:
```json
// μ„Έμ… μ‹μ‘
{
  "session_id": "e7881477-a2be-46eb-9aca-4e34a0380e92",
  "first_question": "λ¨Όμ € κ°„λ‹¨ν• μκΈ°μ†κ°λ¥Ό λ¶€νƒλ“λ¦½λ‹λ‹¤."
}

// μ‹μ¤ν… μƒνƒ
{
  "service_status": "healthy",
  "dependencies": {"stt_service": true, "llm_service": true}
}
```

### π”§ κΈ°μ μ  κ°μ„ μ‚¬ν•­

**1. μ„±λ¥ μµμ ν™”**:
- pydub μ κ±°λ΅ λΌμ΄λΈλ¬λ¦¬ μμ΅΄μ„± κ°μ†
- λ©”λ¨λ¦¬ μ‚¬μ©λ‰ μµμ ν™” (μ¤λ””μ¤ λ³€ν™ κ³Όμ • μ κ±°)
- Whisper λ„¤μ΄ν‹°λΈ μ²λ¦¬λ΅ μ†λ„ ν–¥μƒ

**2. μ½”λ“ ν’μ§ ν–¥μƒ**:
- λ‹¨μΌ μ±…μ„ μ›μΉ™: κ° μ„λΉ„μ¤ νμΌμ΄ λ…ν™•ν• μ—­ν• 
- κΉ”λ”ν• import κµ¬μ΅° λ° μμ΅΄μ„± κ΄€λ¦¬
- μ—λ¬ ν•Έλ“¤λ§ κ°μ„ 

**3. ν™•μ¥μ„± κ°μ„ **:
- μƒλ΅μ΄ μ¤λ””μ¤ ν¬λ§· μ¶”κ°€ μ©μ΄
- LLM ν”„λ΅λ°”μ΄λ” ν™•μ¥ κ°€λ¥ν• κµ¬μ΅°
- λ¨λ“ν™”λ μ•„ν‚¤ν…μ²

### π“ ν„μ¬ μ‹μ¤ν… μƒνƒ

**μ„λ²„ μƒνƒ**: β… http://localhost:8000 μ •μƒ μ‹¤ν–‰
**ν•µμ‹¬ λ¨λ“ μƒνƒ**:
- STT Service: β… healthy (Whisper base λ΅λ“λ¨)
- LLM Service: β… healthy (OpenAI GPT-3.5-turbo μ—°λ™)
- Interview Service: β… healthy (λ¨λ“  μμ΅΄μ„± μ •μƒ)

**API μ—”λ“ν¬μΈνΈ ν„ν™©**: 15κ° μ—”λ“ν¬μΈνΈ λ¨λ‘ μ •μƒ μ‘λ™
- `/api/ai/stt/*` - μμ„± μΈμ‹ (4κ° μ—”λ“ν¬μΈνΈ)
- `/api/ai/llm/*` - AI λ¶„μ„ (5κ° μ—”λ“ν¬μΈνΈ)
- `/api/ai/interview/*` - AI μΈν„°λ·° (6κ° μ—”λ“ν¬μΈνΈ)

### π― λ‹¤μ λ‹¨κ³„ κ³„ν

**μ¦‰μ‹ κ°€λ¥ν• ν…μ¤νΈ**:
1. **μ›Ή μΈν„°νμ΄μ¤**: λΈλΌμ°μ €μ—μ„ μ§μ ‘ ν…μ¤νΈ κ°€λ¥
2. **API λ¬Έμ„**: http://localhost:8000/docs (Swagger UI)
3. **Postman/Thunder Client**: REST API μ§μ ‘ νΈμ¶

**μ‹¤μ  μμ„± ν…μ¤νΈ μ¤€λΉ„μ‚¬ν•­**:
- κ°„λ‹¨ν• ν•κµ­μ–΄ μμ„± νμΌ (WAV/MP3)
- curl λλ” μ›Ή μΈν„°νμ΄μ¤ μ‚¬μ©
- μ‹¤μ‹κ°„ μμ„± λ…Ήμ κΈ°λ¥ (ν–¥ν›„ κµ¬ν„)

**ν–¥ν›„ κ°λ° ν•­λ©**:
- λ²΅ν„° μ„λ² λ”© λ° λ§¤μΉ­ μ•κ³ λ¦¬μ¦ κµ¬ν„
- λ°μ΄ν„°λ² μ΄μ¤ μ—°λ™ (MySQL)
- μ‹¤μ‹κ°„ μμ„± μΈν„°λ·° κΈ°λ¥
- ν”„λ΅ νΈμ—”λ“ μ—°λ™ ν…μ¤νΈ

---

**κ°λ°μ**: AI/μ•κ³ λ¦¬μ¦ λ‹΄λ‹Ή
**κ°λ° κΈ°κ°„**: 2024λ…„ 9μ›” 24μΌ
**μµμΆ… μ—…λ°μ΄νΈ**: 2024λ…„ 9μ›” 24μΌ 23:35 (KST)
**μ„λ²„ μƒνƒ**: μ •μƒ μ‹¤ν–‰ μ¤‘ (http://localhost:8000)
**μ£Όμ” μ„±κ³Ό**: STT + LLM + AI μΈν„°λ·° μ‹μ¤ν… μ™„μ „ ν†µν•© μ™„λ£